{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/jgmikael/trade-automation/credentials/commercial-invoice-schema.json",
  "title": "Commercial Invoice Verifiable Credential",
  "description": "W3C Verifiable Credential schema for KTDDE Commercial Invoice",
  "type": "object",
  "required": ["@context", "type", "issuer", "issuanceDate", "credentialSubject"],
  "properties": {
    "@context": {
      "type": "array",
      "items": [
        {
          "const": "https://www.w3.org/2018/credentials/v1"
        },
        {
          "type": "string",
          "format": "uri"
        }
      ],
      "minItems": 2
    },
    "id": {
      "type": "string",
      "format": "uri"
    },
    "type": {
      "type": "array",
      "contains": {
        "const": "VerifiableCredential"
      },
      "items": {
        "type": "string"
      },
      "minItems": 2
    },
    "issuer": {
      "oneOf": [
        {
          "type": "string",
          "format": "uri"
        },
        {
          "type": "object",
          "required": ["id"],
          "properties": {
            "id": {
              "type": "string",
              "format": "uri"
            },
            "name": {
              "type": "string"
            }
          }
        }
      ]
    },
    "issuanceDate": {
      "type": "string",
      "format": "date-time"
    },
    "expirationDate": {
      "type": "string",
      "format": "date-time"
    },
    "credentialSubject": {
      "type": "object",
      "required": ["id", "type", "invoiceNumber", "invoiceDate", "totalAmount"],
      "properties": {
        "id": {
          "type": "string",
          "format": "uri",
          "description": "DID or URI of the invoice"
        },
        "type": {
          "const": "CommercialInvoice"
        },
        "invoiceNumber": {
          "type": "string",
          "description": "Unique invoice identifier"
        },
        "invoiceDate": {
          "type": "string",
          "format": "date-time",
          "description": "Date the invoice was issued"
        },
        "paymentDueDate": {
          "type": "string",
          "format": "date-time",
          "description": "Date payment is due"
        },
        "totalAmount": {
          "type": "object",
          "required": ["amountValue", "currencyCode"],
          "properties": {
            "type": {
              "const": "MonetaryAmount"
            },
            "amountValue": {
              "type": "number",
              "description": "Total invoice amount"
            },
            "currencyCode": {
              "type": "string",
              "pattern": "^[A-Z]{3}$",
              "description": "ISO 4217 currency code"
            }
          }
        },
        "invoiceeParty": {
          "type": "object",
          "required": ["type", "partyName"],
          "properties": {
            "type": {
              "const": "Party"
            },
            "partyName": {
              "type": "string"
            },
            "legalID": {
              "type": "string",
              "description": "Business registration number or tax ID"
            },
            "hasAddress": {
              "type": "object",
              "properties": {
                "street": {"type": "string"},
                "city": {"type": "string"},
                "postalCode": {"type": "string"},
                "country": {"type": "string"}
              }
            }
          }
        },
        "hasInvoiceLine": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["type", "lineNumber", "productDescription", "lineAmount"],
            "properties": {
              "type": {
                "const": "InvoiceLine"
              },
              "lineNumber": {
                "type": "integer",
                "minimum": 1
              },
              "productDescription": {
                "type": "string"
              },
              "quantity": {
                "type": "object",
                "properties": {
                  "value": {"type": "number"},
                  "unit": {"type": "string"}
                }
              },
              "unitPrice": {
                "type": "object",
                "properties": {
                  "amountValue": {"type": "number"},
                  "currencyCode": {"type": "string", "pattern": "^[A-Z]{3}$"}
                }
              },
              "lineAmount": {
                "type": "object",
                "required": ["amountValue", "currencyCode"],
                "properties": {
                  "amountValue": {"type": "number"},
                  "currencyCode": {"type": "string", "pattern": "^[A-Z]{3}$"}
                }
              }
            }
          },
          "minItems": 1
        }
      }
    },
    "proof": {
      "type": "object",
      "description": "Digital signature proof"
    }
  }
}
